version = 1


[install]
gum.pkg-path = "gum"
redis.pkg-path = "redis"


[vars]
REDISBIND = "127.0.0.1"
REDISPORT = "16379"


[hook]
on-activate = '''

# XXX: https://github.com/flox/flox/issues/1341
unset LD_AUDIT

export REDISHOME="$FLOX_ENV_CACHE/redis"
export REDISDATA="$REDISHOME/data"
export REDISCONFIG="$REDISHOME/redis.conf"

if [ ! -d "$REDISDATA" ]; then
  mkdir -p "$REDISDATA"
fi

cat >$REDISCONFIG <<EOF
bind $REDISBIND
port $REDISPORT
EOF

'''

[profile]
common = '''
echo ""
echo "     â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "     â•‘                                     â•‘"
echo "     â•‘  Start Redis in the background:     â•‘"
echo "     â•‘  ðŸ‘‰ flox services start             â•‘"
echo "     â•‘  ðŸ‘‰ flox activate --start-services  â•‘"
echo "     â•‘                                     â•‘"
echo "     â•‘  Try to connect to Redis:           â•‘"
echo "     â•‘  ðŸ‘‰redis-cli -p \$REDISPORT ping     â•‘"
echo "     â•‘                                     â•‘"
echo "     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
'''

[services]
redis.command = '''
redis-server "$REDISCONFIG" \
  --daemonize no \
  --dir "$REDISDATA"
'''


[options]
systems = [
  "aarch64-darwin",
  "aarch64-linux",
  "x86_64-darwin",
  "x86_64-linux",
]
